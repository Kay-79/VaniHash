generator client_web {
  provider = "prisma-client-js"
  output   = "../web/node_modules/.prisma/client"
}

generator client_indexer {
  provider = "prisma-client-js"
  output   = "../indexer/node_modules/.prisma/client"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Task {
  id            String   @id @default(uuid())
  task_id       String   @unique
  creator       String?
  reward_amount String?
  
  // Pattern fields
  prefix        String?
  suffix        String?
  contains      String?
  
  // New columns
  task_type     Int?     @default(0) // 0 = Object, 1 = Package
  target_type   String?  // The expected object type (e.g. 0x2::coin::Coin<SUI>)
  difficulty    Int?     @default(0)
  lock_duration_ms BigInt? @default(0)
  // bytecode field removed
  
  status        String?
  completer     String?
  tx_digest     String?
  timestamp_ms  BigInt?
  created_at    DateTime @default(now()) @db.Timestamptz(6)

  @@map("tasks")
}

model Listing {
  id           String   @id @default(uuid())
  listing_id   String   @unique
  item_id      String?  // The actual object ID being sold
  seller       String?

  price        String?
  image_url    String? // Display Image URL
  type         String?
  status       String?
  buyer        String?
  price_sold   String?
  tx_digest    String?
  timestamp_ms BigInt?
  created_at   DateTime @default(now()) @db.Timestamptz(6)
  bids         Bid[]

  @@map("listings")
}

model Bid {
  id           String   @id @default(uuid())
  bid_id       String   @unique
  listing_id   String
  listing      Listing  @relation(fields: [listing_id], references: [listing_id])
  bidder       String
  amount       String
  status       String
  tx_digest    String?
  timestamp_ms BigInt?
  created_at   DateTime @default(now()) @db.Timestamptz(6)

  @@map("bids")
}

model Offer {
  id           String   @id @default(uuid())
  offer_id     String   @unique
  item_id      String
  offerer      String
  amount       String
  status       String
  tx_digest    String?
  timestamp_ms BigInt?
  created_at   DateTime @default(now()) @db.Timestamptz(6)

  @@map("offers")
}

model Cursor {
  id         String   @id
  tx_digest  String?
  event_seq  String?
  updated_at DateTime @default(now()) @db.Timestamptz(6)

  @@map("cursors")
}
